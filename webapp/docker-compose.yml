# RedAmon Webapp Docker Compose (standalone)
# For full stack, use the root docker-compose.yml instead.

services:
  webapp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: redamon-webapp
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      # PostgreSQL (Prisma)
      DATABASE_URL: "postgresql://${POSTGRES_USER:-redamon}:${POSTGRES_PASSWORD:-redamon_secret}@host.docker.internal:5432/${POSTGRES_DB:-redamon}"
      # Neo4j (server-side graph queries)
      NEO4J_URI: bolt://host.docker.internal:7687
      NEO4J_USER: neo4j
      NEO4J_PASSWORD: ${NEO4J_PASSWORD:-changeme123}
      # Backend services (via host network)
      RECON_ORCHESTRATOR_URL: http://host.docker.internal:8010
      AGENT_API_URL: http://host.docker.internal:8090
      AGENT_WS_URL: ws://host.docker.internal:8090/ws/agent
      WEBAPP_URL: http://localhost:3000
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
